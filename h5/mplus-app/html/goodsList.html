<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="format-detection" content="telephone=no, address=no, email=no">
<meta name="renderer" content="webkit"><!-- 启用360浏览器的极速模式(webkit) -->
<meta name="apple-mobile-web-app-capable" content="yes"/><!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->
<meta name="apple-mobile-web-app-status-bar-style" content="black"/><!-- 设置苹果工具栏颜色 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge"><!-- 避免IE使用兼容模式 -->
<title>独立卖品</title>
<link rel="stylesheet" href="../css/global.css">
<link rel="stylesheet" href="../css/main.css">
<link rel="stylesheet" type="text/css" href=" ../css/swiper-3.3.0.min.css">
<script src="../js/ux/fontSize.js"></script>
</head>
<body>
<!--<header class="headbar"></header>-->
	<section class="home_page guy">
		<ul class="clearfix shoplist">
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
			<li class="fl">
				<div class="goodsimg">
					<img src="../img/mp.jpg" alt="">
				</div>
				<p class="goods_name">chic水</p>
				<div class="d_box ">
					<span class="g_p" data-js="price">¥64</span>
					<span class="g_m">新品上市</span>
				</div>
				<span class="g_b"></span>
				<div class="goods_tag none">1</div>
			</li>
		</ul>
	</section>
	<footer class="sel_list">
		<div class="fixed_btm clearfix">
	    	<div class="in_block">
	        	<span class="shop_bag"><i data-js="number">1</i></span>
	            <span class="total_goods none" data-js="total_price">￥0</span>
	            <em class="sel_ad">选择心仪的卖品吧</em>
	        </div>
	            
	        <input type="button" class="submit" name="" value="下一步">
	    	
	        <div class="hidden_list">
	        	<h2 class="o_hidden">购买列表<span class="fr del">清空</span></h2>
	            <ul>
	            	
	            </ul>
	        </div>
    	</div>
	</footer>
	<div class="hidden_list1 clearfix">
		<!-- <span class="close"></span>
		<div class="clearfix">
			<img class="fl" src="../img/mp.jpg" alt="">
			<div class="sale_msg fl">
				<h2>chic水</h2>
				<p class="sale_price">
					<span>￥64</span>
				</p>
			</div>
		</div>
		<p class="sec_tit">新品上市</p>
		<div class="d_box sale_info_box">
			<p class="sale_info">购买数量</p>
			<div class="cal_num flex">
				<span class="reduce"></span><i class="num"> 1</i><span class="add"></span>
			</div>
		</div> -->
	</div>
	<div class="markBg none"></div>
	<script src="../js/lib/zepto.min.js"></script>
	<script type="text/javascript">
	$(function(){
		var totHtml=$('[data-js=total_price]').html().substr(1),
			TOTAL = Number(totHtml), 
			LIHTML = '',
			S_NUM = 0,
			totalPrice = $('[data-js=total_price]'),//总价钱
			sel_ad = $('.sel_ad'),//选择心仪的卖品吧那个标签
			mask = $('.markBg'), 
			number;
		number = $('[data-js=number]');
		
		$(".shoplist").on('click','.g_b', function(e){
			var _this = $(this),//添加卖品的加号
				thisLi = _this.closest('li'),
				index = Number(thisLi.index()),//每个li的索引
				thisTag = thisLi.find('.goods_tag'),//每个商品右上角的数字标签
				tagHtml = thisTag.html(),
				num = Number(tagHtml),//每个商品右上角的数字
				name = thisLi.find('.goods_name').html(),//卖品的标题
				hidden_list = $('.hidden_list ul'),
				thispriceHtml=thisLi.find('[data-js=price]').html().substr(1),
				thisPrice = Number(thispriceHtml);//每个商品的单价
				priceHtml=$('[data-js=price]').html().substr(1),
				price = Number(priceHtml);//商品的单价
			e.preventDefault();
			number.show();
			//add a product
			S_NUM++;
			if(thisTag.hasClass('none')){
				thisTag.removeClass('none').html(num);
			} else {
				num++;
				thisTag.html(num);
			}
			TOTAL += thisPrice;
			if(num == 1){
				LIHTML += '<li class="d_box" data-index="_' + index + '"><div class="d_flex info"><span>' + name + '</span><span class="red vm">￥' + price + '</span></div><div class="cal_num flex"><span class="reduce"></span><i class="num">' + num + '</i><span class="add"></span></div></li>';
				hidden_list.html(LIHTML);
			} else {
				hidden_list.find('[data-index=_' + index + ']').find('.num').html(num);
				LIHTML = hidden_list.html();
			}
			
			if(totalPrice.hasClass('none')){
				totalPrice.removeClass('none').html('¥'+TOTAL);
				totalPrice.next('.sel_ad').addClass('none');
			} else {
				totalPrice.html('¥'+TOTAL);
			}
			sel_ad.hide();
			number.html(S_NUM);	
		});
		//点击展开已选卖品列表
		$('.sel_list').on('click', '.in_block', function(){
			var parent = $(this).parent(),
				hidden_list = parent.find('.hidden_list');
			if(TOTAL != 0){
				mask.removeClass('none');
				hidden_list.css({
					bottom: 4.1 + 'rem'
				});
				$('body').css({overflow:'hidden'});
				$('html').css({overflow:'hidden'})
			}
		});
		//在已选列表里，直接删除所有卖品
		$('.hidden_list').on('click', '.del', function(e){
			e.preventDefault();
			$('.shoplist ').find('.goods_tag').html('1').addClass('none');
			$('[data-js=number]').hide();
			$('.hidden_list').css({
				bottom: -17.7 + 'rem'
			});
			mask.addClass('none');
			$('body').css({overflow: 'auto'});
			LIHTML = '';
			TOTAL = 0;
			S_NUM = 0;
			totalPrice.html('¥'+TOTAL);
			number.html(S_NUM);
			$('.hidden_list ul').html(LIHTML);
		});

		//点击其他地方，关闭已选卖品列表
		mask.on('click',function(event){
			if(this==event.target){
				$('body').css({overflow: 'auto'});
				$('.hidden_list').css({
					bottom: -17.7 + 'rem'
				});
				$(this).addClass('none');
			}
		});
		//在已选卖品列表里修改数量
		$('.sel_list').on('click', '.reduce, .add', function(){
			var _T = $(this),
				p = _T.parent(),
				li = _T.closest('li'),
				info_pHtml = li.find('.info .vm').html().substr(1),
				info_p=Number(info_pHtml),
				index = li.data('index').slice(1),
				num_obj = p.find('.num'),
				pro_num = num_obj.html(),
				goods_tag = $('.shoplist li').eq(index).find('.goods_tag');
			
			if(_T.hasClass('reduce')){
				pro_num--;
				S_NUM--;
				TOTAL -= info_p;
			} else {
				pro_num++;
				S_NUM++;
				TOTAL += info_p;
			}
			
			if(pro_num == 0){
				li.remove();
				goods_tag.addClass('none');
			} else {
				num_obj.html(pro_num);
				goods_tag.html(pro_num);
			}
			
			if(S_NUM == 0){
				number.hide();
				$('.hidden_list').css({
					bottom: -17.7 + 'rem'
				});
				mask.addClass('none');
				$('body').css({overflow: 'auto'});
				$('html').css({overflow: 'auto'});
				LIHTML = '';
				TOTAL = 0;
			} else {
				number.html(S_NUM);
			}
			totalPrice.html('¥'+TOTAL);
		});
	
		thisEl="";
		tag_price=0;
		//追加卖品详情结构
		$('.shoplist').on('click','.goodsimg',function(){
			var sale_tit=$(this).parent().find('.goods_name').text(),
				sec_tit=$(this).parent().find('.g_m').text(),
				each_priceHtml=$(this).parent().find('[data-js=price]').text().substr(1),
				each_price=Number(each_priceHtml),
				thisLi = $(this).closest('li');

				//全局
				thisEl=thisLi;
				tag_price=Number($(this).parent().find('.goods_tag').text());

				//console.log(thisLi);
				if(thisLi.find('.goods_tag').hasClass('none')){
					tag_price=0;
				};
			var htmls='<span class="close"></span><div class="clearfix"><img class="fl" src="../img/mp.jpg" alt=""><div class="sale_msg fl"><h2>'+sale_tit+'</h2><p class="sale_price"><span>￥'+each_price+'</span></p></div></div><p class="sec_tit">'+sec_tit+'</p><div class="d_box sale_info_box"><p class="sale_info">购买数量</p><div class="cal_num flex"><span class="reduce"></span><i class="num"> '+tag_price+' </i><span class="add"></span></div></div>';
			$('.hidden_list1').html(htmls)
			$('.hidden_list1').css('bottom',4.1+'rem');
			mask.removeClass('none');
			$('body').css({overflow: 'hidden'});
			$('html').css({overflow:'hidden'});
		})
		//点击卖品详情里的加减改变数量
		$('.hidden_list1').on('click', '.reduce, .add', function(){
			tag_price=thisEl.find('.goods_tag').text();
			if(thisEl.find('.goods_tag').hasClass('none')){
				tag_price=0;
			};
			var s_num='';
			if($(this).hasClass('reduce')){
				if(tag_price==0) {
					return false;
				}else{
				tag_price--;
				s_num=$(this).siblings('.num').html(tag_price);
				$("li[data-index='_"+thisEl.index()+"']").find(".reduce").click();
				}
				if(tag_price==0){
					mask.removeClass('none');
				}

			} else {
				tag_price++;
				s_num=$(this).siblings('.num').html(tag_price);
				thisEl.find(".g_b").click();
			}
		});
		//点击关闭隐藏列表
		$('.hidden_list1').on('click','.close',function(){
			mask.addClass('none')
			$(this).parent().css('bottom',-17.7+'rem');
			$('body').css({overflow: 'auto'});
			$('html').css({overflow: 'auto'});
		});
		//点击其他地方隐藏列表
		mask.on('click',function(){
			$(this).addClass('none');
			$('.hidden_list1').css('bottom',-17.7+'rem');
			$('body').css({overflow: 'auto'});
			$('html').css({overflow: 'auto'});
		});
		$(".submit").click(function(){window.location.href="firmOrder.html";});
	});
	</script>
</body>
</html>